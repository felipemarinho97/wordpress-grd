var EditPostPreviewAdmin=function(a){"use strict";var b={data:{customize_url:null,is_compat:!1,previewed_post:null,customize_posts_update_changeset_nonce:null}};return"undefined"!=typeof _editPostPreviewAdminExports&&a.extend(b.data,_editPostPreviewAdminExports),b.init=function(){b.previewButton=a("#post-preview"),b.previewButtonSpinner=a("span.spinner").first().clone(),b.previewButton.after(b.previewButtonSpinner),b.previewButton.off("click.post-preview").on("click.post-preview",b.onClickPreviewBtn)},b.onClickPreviewBtn=function(c){var d,e,f,g,h,i,j=a(this),k=a("#post_ID").val(),l=a("#post_type").val(),m={},n=tinymce.get("content");c.preventDefault(),j.hasClass("disabled")||(wp.customize.Loader.link=j,f=wp.customize.Loader.settings.browser.mobile,wp.customize.Loader.settings.browser.mobile=!1,wp.customize.Loader.close=b.closeLoader,g=parseInt(a("#parent_id").val(),10),g||(g=0),h=parseInt(a("#menu_order").val(),10),h||(h=0),e={post_title:a("#title").val(),post_name:a("#post_name").val(),post_parent:g,menu_order:h,post_content:n&&!n.isHidden()?wp.editor.removep(n.getContent()):a("#content").val(),post_excerpt:a("#excerpt").val(),comment_status:a("#comment_status").prop("checked")?"open":"closed",ping_status:a("#ping_status").prop("checked")?"open":"closed",post_author:parseInt(a("#post_author_override").val(),10)},d="post["+l+"]["+k+"]",m[d]=e,wp.customize.trigger("settings-from-edit-post-screen",m),b.data.is_compat?(sessionStorage.setItem("previewedCustomizePostSettings["+k+"]",JSON.stringify(m)),wp.customize.Loader.open(b.data.customize_url),wp.customize.Loader.settings.browser.mobile=f,b.bindChangesFromCustomizer(d,n)):(j.addClass("disabled"),b.previewButtonSpinner.addClass("is-active is-active-preview"),i=wp.ajax.post("customize_posts_update_changeset",{customize_posts_update_changeset_nonce:b.data.customize_posts_update_changeset_nonce,previewed_post:b.data.previewed_post,customize_url:b.data.customize_url,input_data:e}),i.fail(function(a){var b,c=JSON.parse(a.responseText);c.data&&(b=c.data.replace(/_/g," "),alert(b.charAt(0).toUpperCase()+b.slice(1)))}),i.done(function(a){wp.customize.Loader.open(a.customize_url),wp.customize.Loader.settings.browser.mobile=f,b.bindChangesFromCustomizer(d,n)}),i.always(function(){j.removeClass("disabled"),b.previewButtonSpinner.removeClass("is-active is-active-preview")})))},b.bindChangesFromCustomizer=function(b,c){wp.customize.Loader.messenger.bind("customize-post-settings-data",function(d){var e;d[b]&&(a("#title").val(d[b].post_title).trigger("change"),c&&c.setContent(wp.editor.autop(d[b].post_content)),a("#content").val(d[b].post_content).trigger("change"),a("#excerpt").val(d[b].post_excerpt).trigger("change"),a("#comment_status").prop("checked","open"===d[b].comment_status).trigger("change"),a("#ping_status").prop("checked","open"===d[b].ping_status).trigger("change"),a("#post_author_override").val(d[b].post_author).trigger("change"),a("#post_name").val(d[b].post_name).trigger("change"),e=d[b].post_parent,a("#parent_id").val(e>0?String(e):"").trigger("change"),a("#menu_order").val(String(d[b].menu_order)).trigger("change"),a("#new-post-slug").val(d[b].post_name),a("#editable-post-name, #editable-post-name-full").text(d[b].post_name)),wp.customize.trigger("settings-from-customizer",d)})},b.getPostMetaSettingId=function(b){var c,d;return c=a("#post_ID").val(),d=a("#post_type").val(),"postmeta["+d+"]["+c+"]["+b+"]"},b.closeLoader=function(){this.active&&(this.active=!1,this.trigger("close"),this.originalDocumentTitle&&(document.title=this.originalDocumentTitle),this.link&&this.link.focus())},b}(jQuery);